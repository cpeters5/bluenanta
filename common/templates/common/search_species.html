{% load static %}
{% load static %}
{% include "base.html" %}
{% block body %}
{% load testtags %}
<style>
    .btn_result {
        font-size: 20px;
        color: #0a6aa1;
        font-weight: bold;
    }
</style>
<div style="min-height:200px;background-color:white;width: 100%;">
    <div style="clear:both"></div>
    <div class="row" style="width:100%; margin:0 auto;">
        <div class="col-3 d-none d-lg-block" style="padding:0">
           {% include "common/taxonomy.html" %}
        </div>
        <div class="col" style="text-align:left;font-size:13px;margin-top:25px;">
            <div class="card-body"  style="width:100%; display:inline-block; padding-top:0;">
                <div style="padding:0; margin: 0">
                    <a class="btn btn-custom" href="{% url 'common:genera' %}?family={{family}}&subfamily={{subfamily}}&tribe={{tribe}}&subtribe={{subtribe}}">Show genera</a>
                    {% if not genus or genus.num_hybrid > 0 %}
                        <a class="btn btn-custom m1" href="{% url 'common:species' %}?family={{family}}&subfamily={{subfamily}}&tribe={{tribe}}&subtribe={{subtribe}}&genus={{genus}}&alpha={{alpha}}&syn=N">Show species</a>
                    {% endif %}
                    <a class="btn btn-custom" href="{% url 'common:browse' %}?family={{family}}&genus={{genus}}&display=checked">Browse</a>
                    {% if app == 'orchidaceae' %}<a class="btn btn-custom m1" href="{% url 'orchidaceae:species' %}?family=Orchidaceae&alpha=A&syn=N">Full species list</a>{% endif %}
                </div>
                <br>
                <h6>Searching for "<i>{{spc_string}}</i>"</h6>
                {% if genus_list or match_list or perfect_list %}
                    <table width="95%">
                        <tr>
                            <th width="70%">Matching species from {{family.family|default:'all families'}}</th>
                            <th> num images</th>
                        </tr>

                    {% if match_list or perfect_list %}
                        {% if perfect_list %}
                            {% for x in perfect_list %}
                            <tr>
                                <td>
                                    {% if x.status == 'synonym' and x.type == 'species' %}
                                        <i>{{ x.binomial }}</i>
                                    {% elif x.status == 'synonym' %}
                                        {{ x.binomial }}
                                    {% else %}
                                        <a href="/common/{{path}}/{{x.pid}}/?family={{x.gen.family}}&species={{x.binomial}}"><i>{{ x.binomial_it|safe }}</i></a>
                                    {% endif %}
                                    {{x.author|default:''}}
                                    ({{x.gen.family}})
                                    {% if x.status == 'synonym' %}
                                       (syn. <a href="/common/{{path}}/{{x.getAcc}}/?family={{x.gen.family}}&species={{x.binomial}}">{{x.getAccepted.binomial_it|safe}}</a>)
                                    {% endif %}
                                </td>
                                <td>
                                    {{x.num_image|default:''}}
                                </td>
                            </tr>
                            {% endfor %}
                        {% elif match_list %}
                            {% for x in match_list %}
                            <tr>
                                <td>
                                    <a href="/common/{{path}}/{{x.pid}}/?family={{x.gen.family}}&species={{x.binomial}}">{{ x.binomial_it|safe }}</a>
                                    {{x.author|default:''}}
                                    ({{x.gen.family}})
                                    {% if x.status == 'synonym' %}
                                        (syn. <a href="/common/{{path}}/{{x.getAcc}}/?family={{x.gen.family}}&species={{x.binomial}}">{{x.getAccepted.binomial_it|safe}}</a>)
                                   {% endif %}
                                   {{x.num_image|default:''}}
                                </td>
                                <td>{{x.gen.family.num_image}}</td>
                            </tr>
                            {% endfor %}
                        {% endif %}
                    {% else %}
                        <tr><td>No smatching species found</td></tr>
                    {% endif %}
                    </table>
                    {% if genus_list %}
                    <br>
                    <table style="width:95%">
                        <tr>
                            <th width="70%">Approximately matched genera</th>
                            <th>Current status</th>
<!--                            <th>Score</th>-->
                        </tr>
                        {% for genus in genus_list %}
                        <tr>
                            <td>
                                {% if not genus.0.num_hybrid or genus.0.num_species > 0 %}<a href="/common/species/?family={{genus.0.family}}&genus={{genus.0.genus}}"><i>{{genus.0.genus}}</i></a> {{genus.0.author|default:''}} {{genus.0.year|default:''}} {% if genus.0.status == 'synonym' %}(syn.){% endif %} {% if genus.0.type == 'hybrid' %} ({{genus.0.description|default:''}}) {% endif %}</a>
                                {% else %}<a href="/common/hybrid/?family={{genus.0.family}}&genus={{genus.0.genus}}"><i>{{genus.0.genus}}</i></a>  {{genus.0.author|default:''}} {{genus.0.year|default:''}} {% if genus.0.status == 'synonym' %}(syn.){% endif %} {% if genus.0.type == 'hybrid' %} ({{genus.0.description|default:''}}) {% endif %}
                                {% endif %}
                                ({{genus.0.family}})
                            </td>
                            <td>
                                species: {{genus.0.num_species|default:"0"}}
                                hybrid: {{genus.0.num_hybrid|default:"0"}}
                            </td>
<!--                            <th>{{genus.1}}</th>-->
                        </tr>
                        {% endfor %}
                    </table>
                    {% endif %}
                {% else %}
                    {% if fuzzy_list %}
                        <br>
                            {% if match_list %}
                                fuzzy matches
                            {% endif %}
                        <table width="95%">
                            <tr>
                                <th width="70%">Approximate matching Species from {{family.family|default:'all families'}}</th>
                                <th>Num. images</th>
                            </tr>
                        {% for x in fuzzy_list %}
                            <tr>
                                <td>
                                    {% if x.0.status != 'synonym' %}
                                        <a href="/common/{{path}}/{{x.0.pid}}/?family={{x.0.gen.family}}&species={{x.0.binomial}}">{{ x.0.binomial_it|safe }}</a>
                                        {{x.0.author|default:''}}
                                        {{x.0.year|default:''}}
                                        {{x.0.description|default:''}}
                                    {% else %}
                                        {{ x.0.binomial_it|safe }}
                                        {{x.0.author|default:''}}
                                        {{x.0.year|default:''}}
                                        (syn. <a href="/common/{{path}}/{{x.0.getAcc}}/?family={{x.0.family}}&species={{x.0.binomial}}">{{x.0.getAccepted.binomial_it|safe}}</a>)
                                    {% endif %}
                                    ({{x.0.gen.family}})
                                </td>
                                <td>
                                    {{x.0.num_image|default:''}}
                                </td>
                            </tr>
                        {% endfor %}
                        </table>
                    {% else %}
                        <br><b>
                        {% if not fuzzy %}
                            Your search returned no matches for
                            {{family.family|default:app}} families. Please try switch to another family or choose "All Other families" to expand the search to families other than Orchidaceae, Cactaceae and Bromeliaceae.
                             or click on the "Aproximate search" button for imprecise matching
                        {% else %}
                            Sorry, even imprecise search couldn't find close enough matches for your search criteria.  Please select a different family.
                        {% endif %}
                        </b><br>
                    {% endif %}
                    </table>
                {% endif %}
                {% if not fuzzy %}
                    <div style="padding: 0; margin-top: 20px;">
                        Didn't see what you are looking for?<br>
                        <a class="btn btn-custom" style="width: 150px;" href="{% url 'common:search_species' %}?family={{family}}&spc_string={{spc_string}}&role={{role}}&app={{app}}&fuzzy=1">Aproximate search</a>
                    </div>
                {% endif %}
                <br>
                <div class="btn btn-custom" onclick="history.back()">
                    Go back
                </div>
            </div>
        </div>
    </div>
</div>
<script>

$(document).ready(function(){
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = localStorage.getItem('activeTab');
    if(activeTab){
        $('#myTab a[href="' + activeTab + '"]').tab('show');
    }
});

$(document).on('click', '[data-toggle="lightbox"]', function(event) {
                event.preventDefault();
                $(this).ekkoLightbox();
            });

$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
});


</script>
{% endblock %}
